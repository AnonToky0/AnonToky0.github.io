---
title: "红黑树"
date: 2025-08-26 16:00:00 +0800
categories: [数据结构与算法]
tags: [C++, 红黑树, 二叉树]
---

红黑树是一种(自平衡)的二叉搜索树，由于左右子树高度差有可能大于1，所以不是严格意义上的平衡二叉树

### 特征：
1. 每个节点带有颜色属性：红色或黑色
2. 根节点是黑色
3. 叶子节点为黑色：这里说的叶子节点是底层的空节点(NULL)
4. 一个节点为红色，子节点必须都是黑色
5. 黑色平衡：从任一节点到其所有后代叶子节点的路径上，均包含相同数目的黑色节点

### 为什么需要红黑树？
    AVL树(平衡二叉搜索树)的优点是查找、插入、删除的时间复杂度都是O(logN)
    但是插入或删除后高度差可能大于1导致平衡性破坏，为了维持平衡性需要对其旋转，而旋转的成本不小。
    如果插入数据随机，那么它就是接近平衡的二叉树。
        但是极端情况下插入数据有序，所有节点都在根节点的一侧，此时平衡树退化为链表，时间复杂度O(N)
        红黑树能解决这种非平衡问题。
    优点：对有序数据的查询操作不会慢到O(N)的时间复杂度
### 红黑树的等价交换：
    将所有红色节点上移到和父节点同一高度，就是一棵四阶B树
    红黑树的黑色节点个数与4阶B树的节点总数相等
    在所有B树节点中，永远是黑色节点是父节点，红色节点是子节点。黑色节点在中间，红色节点在两边

## 查找：
作为二叉搜索树，与一般查找方式相同：  
从根节点开始，比较目标值与节点值，相同返回，目标值小于当前节点值转向右节点，大于转向左节点
## 插入O(logN)：
1. 按二叉搜索树的规则插入，并将其颜色设为红色
2. 如果父节点是黑色，不需要额外操作
3. 如果父节点是红色，需要恢复红黑树的性质(旋转和染色)
    - 分两种情况：
        - 3.1 如果叔叔节点为红色
            -将父节点和叔叔节点颜色改为黑色
            -将祖父节点颜色改为红色
            -将问题移到祖父节点上，递归进行调整
        - 3.2 叔叔节点为黑色
            如果插入节点在父节点的右子树，同时父节点在祖父节点的左子树(“<”),进行左旋
            如果插入节点在父节点的左子树，同时父节点在祖父节点的右子树(“>”),进行右旋
            调整父节点和祖父节点的颜色
## 删除O(logN):
1. 按二叉搜索树的规则找到要删除的节点
2. 如果要删除的节点有两个子节点
    找到其中序后继(中序遍历的下一个节点)，将其值复制到当前节点，然后删除后继节点。 后继或前驱都行
3. 删除的节点颜色处理：
    如果是红色节点直接删除
    如果是黑色节点：
        一系列调整，根据兄弟节点和邻居节点颜色确定。

## 旋转：
- 分为左旋和右旋
- 左旋：将某个节点旋转为其右孩子的左孩子
- 右旋：将某个节点旋转为其左孩子的右孩子
