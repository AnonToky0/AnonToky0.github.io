---
title: "Hash"
date: 2025-08-26 15:00:00 +0800
categories: [Hash]
tags: [C++, 算法, Hash]
---

Hash是一种常见的用于快速存储和查找的数据结构和算法。最常见的Hash数据结构是Hash表(Hash Table)。

Hash表通过将键(Key)映射到值(Value)的方式，实现高效的数据查找。  
组成：
1. 数组：用于存储数据的主结构，称为桶(bucket)，每个存储单元为一个桶
2. 哈希函数：将键映射到数据索引的函数
3. 冲突处理机制：处理不同键映射到同一数据位置的情况
			
### 哈希函数
一个好的哈希函数应具备以下特性：
- 确定性：相同输入始终产生相同输出
- 均匀性：均匀地分布输入，减少冲突
- 高效性: 计算速度快，适用于高频调用  
实际操作中会对Hash值取模以适应桶大小
常用哈希函数：
1.1 除留余法：
``` C++
Hash(key)=key%TableSize
```
简单易实现，但当输入有规律时，可能导致冲突增多
1.2 乘法散列法：   
将输入乘以一个常数A，取其小数部分，再乘以表大小并取整。
``` C++
Hash(key) = [TableSize*(key*A mod1)]
```
A是一个介于0~1的常数，通常取(√5−1)/2, 即黄金分割比

1.3 通用字符串哈希函数，如Djb2, sdbm
		
### 冲突处理机制：
不同的键映射到同一索引，这种现象称为碰撞(collision)。处理碰撞的方法主要有两种：链式法，开发地址法
#### 1. 链式法
在每个数组位置存储一个链表(或其他数据结构如平衡树)。所有映射到同一索引的元素都存储在该链表中。
- 优点：	实现简单，易于扩展
- 缺点：	最坏的查询时间是O(n), 需要额外的空间存储指针

#### 2. 开放地址法
所有元素存储在数组中，发生冲突时，按照一定探查序列寻找下一个可用位置。常见探查方法包括线性探查、二次探查、双重哈希
- 优点：	
	- 无需额外地址空间，空间利用率高
	- 数据局部性好，适合缓存友好
- 缺点：	
	- 实现较复杂，容易产生团聚现象，影响性能
	- 删除操作复杂

常见探查方法：  
1. 线性探查：
``` C++
	Index = (hash(key)+i)%TableSize, i=0,1,2
```
- 按固定步长依次查找接下来的槽，直到找到空闲槽为止
- 缺点：相邻槽形成聚集区，增加探查的次数
2. 二次探查：
``` C++
	Index = (hash(key)+c1*i+c2*i^2)%TableSize, i=0,1,2
```
- 优点：相比线性探查可以减少聚集
3. 双重哈希
``` C++
	Index = (hash1(key)+i*hash2(key))%TableSize, i=0,1,2
```

#### 3. 布谷鸟哈希
- 使用两个哈希表和两个哈希函数，每个键都有两个可能的位置。
- 插入时，尝试插入位置1，如果位置1被占用，驱逐原有值并插入
	- 尝试将**原有值**插入位置2，如果位置2也被占用，驱逐位置2原有值，并递归插入
	- 若达到预定驱逐次数阈值，重新哈希整个表，通常使用新的哈希函数或增大表大小
#### 4. Hopscotch 哈希
- 结合了链式法和开放地址法的优点。
- 将每个元素尽可能存储在其"主桶"附近的一个固定距离范围内。这种限制操作使得查找操作可以在常数时间内完成。
- 如果附近没有空闲桶，尝试通过移动现有元素的位置，在临近区外找到一个空闲桶。
#### 5. 罗宾汉哈希
- 开放地址法的改进。
- [探测深度]：对于某个键，探测深度是从初始哈希槽到实际存储槽的距离。
- 罗宾汉哈希的思想是在插入过程中，较短探测序列的键可以被后插入且探测序列更长的键"抢劫"，即交换位置。
- 插入操作中：
	1. 计算键的初始值，确定初始槽位置
	2. 若初始槽被占用，比较当前槽中键的探测深度与待插入键的探测深度
	3. 如果待插入键的探测深度大于当前槽中键的探测深度，交换两者位置，并将被替换的键作为新的待插入键。
	
### 负载因子和再哈希
负载因子是哈希表中元素数量和桶数量的比值，通常表示为`α = n/m`. n是元素数量，m是桶数量。
	低负载因子空间利用率低，但查询速度快。
	高负载因子空间利用率高，但可能导致更多冲突，影响查询速度。
	
#### 再哈希
当负载因子超过预定阈值时，哈希表会进行扩容。
步骤：  
1. 选择新的桶数量：大约是原来两倍的质数。
2. 分配新的数组
3. 重新计算所有已有元素的哈希值，并插入新的数组中

### 字符串处理机制
特点：
- 复制存储：将字符串作为键插入哈希表，哈希表通常会存储字符串的一个副本。目的是确保内部键数据不会因外部修改而改变
- 引用存储：某些优化实现中，哈希表可能存储指向字符串的引用或指针，特别是在字符串不需要修改且可以安全共享的情况下。
- 常见哈希函数包括djb2, sdbm, MD5